---
import BaseLayout from '../layouts/BaseLayout.astro';
import Container from '../components/Container.astro';
import ServiceCard from '../components/ServiceCard.astro';
import Button from '../components/Button.astro';
import CloudflareImage from '../components/CloudflareImage.astro';
import { CONTACT } from '../lib/config';
import { getAllConditions } from '../lib/sanityQueries';
import { conditionCategories } from '../types/sanity';

const categoryOrder = ['pain', 'mental-health', 'womens-health', 'digestive', 'immune', 'other'] as const;

const allConditions = await getAllConditions();
const conditionsByCategory = categoryOrder
  .map((key) => ({
    category: conditionCategories[key] || key,
    categoryKey: key,
    items: allConditions.filter((c) => c.category === key),
  }))
  .filter((group) => group.items.length > 0);
---

<BaseLayout
  title="Conditions We Treat"
  description="Discover how acupuncture can help with pain, stress, women's health, digestive issues, allergies, and many other conditions. Natural, effective healing solutions."
>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-sage-50 to-warm-white py-16 md:py-20">
    <Container>
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-heading font-bold text-charcoal mb-6">
          Conditions We Treat
        </h1>
        <p class="text-lg md:text-xl text-gray-600 leading-relaxed mb-8">
          Acupuncture and Chinese herbal medicine can effectively treat a wide range of health conditions. Our experienced practitioners have helped thousands of patients find natural relief and lasting wellness.
        </p>
        <Button variant="primary" size="lg" icon="calendar" href="/contact">
          Schedule Consultation
        </Button>
      </div>
    </Container>
  </section>

  <!-- Wellness Banner -->
  <section class="bg-white">
    <Container>
      <div class="aspect-[21/9] rounded-2xl overflow-hidden max-w-7xl mx-auto">
        <CloudflareImage
          imageId="wp-17448"
          alt="Peaceful meditation and wellness"
          width={1200}
          height={514}
          fit="cover"
          class="w-full h-full object-cover"
        />
      </div>
    </Container>
  </section>

  <!-- Conditions by Category -->
  {conditionsByCategory.map((category, index) => (
    <section class={`py-16 md:py-20 lg:py-24 ${index % 2 === 0 ? 'bg-white' : 'bg-sage-50'}`}>
      <Container>
        <div class="mb-12 md:mb-16 flex flex-col md:flex-row md:items-center gap-6">
          <div class="flex-1">
            <h2 class="text-3xl md:text-4xl font-heading font-bold text-charcoal mb-4">
              {category.category}
            </h2>
            <div class="w-24 h-1 bg-sage-600 rounded-full"></div>
          </div>
          {category.category === 'Pain Management' && (
            <div class="w-full md:w-64 aspect-[16/9] rounded-xl overflow-hidden flex-shrink-0">
              <CloudflareImage
                imageId="wp-15636"
                alt="Back pain relief through acupuncture"
                width={400}
                height={225}
                fit="cover"
                class="w-full h-full object-cover"
              />
            </div>
          )}
          {category.category === "Women's Health" && (
            <div class="w-full md:w-64 aspect-[16/9] rounded-xl overflow-hidden flex-shrink-0">
              <CloudflareImage
                imageId="wp-16741"
                alt="Women's health and pregnancy support"
                width={400}
                height={225}
                fit="cover"
                class="w-full h-full object-cover"
              />
            </div>
          )}
        </div>

        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
          {category.items.map((item) => (
            <ServiceCard
              title={item.name}
              description={item.description}
              href={`/conditions/${item.slug.current}`}
              icon={item.icon}
            />
          ))}
        </div>
      </Container>
    </section>
  ))}

  <!-- How Acupuncture Helps -->
  <section class="py-16 md:py-20 lg:py-24 bg-gradient-to-br from-sage-100 to-warm-white">
    <Container>
      <div class="max-w-4xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-heading font-bold text-charcoal mb-8 text-center">
          How Acupuncture Helps
        </h2>

        <div class="space-y-6">
          <div class="bg-white p-6 md:p-8 rounded-[var(--radius-lg)] border border-sage-200">
            <h3 class="text-xl font-heading font-semibold text-charcoal mb-3">
              Restores Balance
            </h3>
            <p class="text-gray-700 leading-relaxed">
              Acupuncture works by stimulating specific points along energy pathways (meridians) to restore balance and harmony in the body. This ancient practice activates your body's natural healing mechanisms.
            </p>
          </div>

          <div class="bg-white p-6 md:p-8 rounded-[var(--radius-lg)] border border-sage-200">
            <h3 class="text-xl font-heading font-semibold text-charcoal mb-3">
              Reduces Inflammation
            </h3>
            <p class="text-gray-700 leading-relaxed">
              Research shows acupuncture can reduce inflammatory markers and promote healing. This makes it particularly effective for pain management and chronic inflammatory conditions.
            </p>
          </div>

          <div class="bg-white p-6 md:p-8 rounded-[var(--radius-lg)] border border-sage-200">
            <h3 class="text-xl font-heading font-semibold text-charcoal mb-3">
              Regulates Hormones
            </h3>
            <p class="text-gray-700 leading-relaxed">
              Acupuncture helps regulate the endocrine system, making it highly effective for hormone-related conditions like PMS, menopause, and fertility issues.
            </p>
          </div>

          <div class="bg-white p-6 md:p-8 rounded-[var(--radius-lg)] border border-sage-200">
            <h3 class="text-xl font-heading font-semibold text-charcoal mb-3">
              Strengthens Immunity
            </h3>
            <p class="text-gray-700 leading-relaxed">
              Regular acupuncture treatments boost immune function, helping your body defend against illness and recover more quickly when you do get sick.
            </p>
          </div>
        </div>
      </div>
    </Container>
  </section>

  <!-- Not Listed Section -->
  <section class="py-16 md:py-20 lg:py-24 bg-white">
    <Container>
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-heading font-bold text-charcoal mb-6">
          Don't See Your Condition Listed?
        </h2>
        <p class="text-lg md:text-xl text-gray-600 mb-8 leading-relaxed">
          This list represents just some of the many conditions we treat. Acupuncture is effective for a wide range of health concerns. Contact us to discuss how we can help with your specific needs.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button variant="primary" size="lg" icon="phone" href={`tel:+1${CONTACT.phone.replace(/\D/g, '')}`}>
            Call {CONTACT.phone}
          </Button>
          <Button variant="tertiary" size="lg" icon="mail" href="/contact">
            Send a Message
          </Button>
        </div>
      </div>
    </Container>
  </section>

  <!-- CTA Section -->
  <section class="py-16 md:py-20 lg:py-24 bg-gradient-to-br from-sage-600 to-healing-blue text-white">
    <Container class="text-center">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-heading font-bold mb-4 md:mb-6">
        Ready to Find Natural Relief?
      </h2>
      <p class="text-lg md:text-xl mb-8 md:mb-10 max-w-2xl mx-auto opacity-90 leading-relaxed">
        Take the first step toward better health. Schedule your consultation today and discover how acupuncture can help you.
      </p>
      <Button variant="secondary" size="lg" icon="calendar" href="/contact">
        Book Your Appointment
      </Button>
    </Container>
  </section>
</BaseLayout>
