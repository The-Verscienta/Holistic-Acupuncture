---
import { getCloudflareImageUrlWithOptions, type CloudflareImageOptions } from '../lib/cloudflare';

interface Props {
  imageId: string;
  alt: string;
  width?: number;
  height?: number;
  fit?: 'scale-down' | 'contain' | 'cover' | 'crop' | 'pad';
  quality?: number;
  class?: string;
  loading?: 'lazy' | 'eager';
  /** Hint for LCP image (e.g. hero). Use "high" only for the single above-the-fold image. */
  fetchpriority?: 'high' | 'low' | 'auto';
}

const {
  imageId,
  alt,
  width,
  height,
  fit = 'cover',
  quality = 85,
  class: className,
  loading = 'lazy',
  fetchpriority,
} = Astro.props;

// Generate optimized image URL (WebP for smaller size and fast load)
const imageUrl = getCloudflareImageUrlWithOptions(imageId, 'public', {
  width,
  height,
  fit,
  quality,
  format: 'webp',
});

// Generate srcset for responsive images
const srcset = width
  ? `${imageUrl} 1x, ${getCloudflareImageUrlWithOptions(imageId, 'public', {
      width: width * 2,
      height: height ? height * 2 : undefined,
      fit,
      quality,
      format: 'webp',
    })} 2x`
  : undefined;
---

<img
  src={imageUrl}
  srcset={srcset}
  alt={alt}
  width={width}
  height={height}
  loading={loading}
  decoding="async"
  fetchpriority={fetchpriority}
  class={className}
/>
